(function(t){function e(e){for(var r,i,a=e[0],u=e[1],l=e[2],c=0,d=[];c<a.length;c++)i=a[c],n[i]&&d.push(n[i][0]),n[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);p&&p(e);while(d.length)d.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var t,e=0;e<o.length;e++){for(var s=o[e],r=!0,i=1;i<s.length;i++){var u=s[i];0!==n[u]&&(r=!1)}r&&(o.splice(e--,1),t=a(a.s=s[0]))}return t}var r={},n={app:0},o=[];function i(t){return a.p+"js/"+({about:"about"}[t]||t)+"."+{about:"0e0c8bab"}[t]+".js"}function a(e){if(r[e])return r[e].exports;var s=r[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.e=function(t){var e=[],s=n[t];if(0!==s)if(s)e.push(s[2]);else{var r=new Promise(function(e,r){s=n[t]=[e,r]});e.push(s[2]=r);var o,u=document.createElement("script");u.charset="utf-8",u.timeout=120,a.nc&&u.setAttribute("nonce",a.nc),u.src=i(t),o=function(e){u.onerror=u.onload=null,clearTimeout(l);var s=n[t];if(0!==s){if(s){var r=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src,i=new Error("Loading chunk "+t+" failed.\n("+r+": "+o+")");i.type=r,i.request=o,s[1](i)}n[t]=void 0}};var l=setTimeout(function(){o({type:"timeout",target:u})},12e4);u.onerror=u.onload=o,document.head.appendChild(u)}return Promise.all(e)},a.m=t,a.c=r,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(s,r,function(e){return t[e]}.bind(null,r));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a.oe=function(t){throw console.error(t),t};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=e,u=u.slice();for(var c=0;c<u.length;c++)e(u[c]);var p=l;o.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("cd49")},3707:function(t,e,s){},cd49:function(t,e,s){"use strict";s.r(e);var r=s("2b0e"),n=s("ce5b"),o=s.n(n);s("da64");r["default"].use(o.a,{iconfont:"md"});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-app",[s("v-navigation-drawer",{attrs:{"hide-overlay":"",fixed:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[s("v-list",[t.store.user?s("v-list-tile",{attrs:{to:"/"}},[s("v-list-tile-action",[s("v-icon",[t._v("home")])],1),s("v-list-tile-content",[s("v-list-tile-title",[t._v("\n\t\t\t\t\t\tブログシステム\n\t\t\t\t\t")])],1)],1):t._e(),s("v-divider"),s("UserForList",{attrs:{user:t.store.user}}),s("v-divider"),t.store.user?s("v-list-tile",{attrs:{to:"/_do_post"}},[s("v-list-tile-action",[s("v-icon",[t._v("create")])],1),s("v-list-tile-content",[s("v-list-tile-title",[t._v("\n\t\t\t\t\t\t記事を書く\n\t\t\t\t\t")])],1)],1):t._e(),s("v-list-tile",{attrs:{to:"/about"}},[s("v-list-tile-action",[s("v-icon",[t._v("info")])],1),s("v-list-tile-content",[s("v-list-tile-title",[t._v("\n\t\t\t\t\t\tこのサイトについて\n\t\t\t\t\t")])],1)],1)],1)],1),s("v-toolbar",{attrs:{app:""}},[s("v-toolbar-side-icon",{on:{click:function(e){t.drawer=!t.drawer}}}),s("v-toolbar-title",[s("router-link",{attrs:{to:"/"}},[t._v("\n\t\t\t\tブログシステム\n\t\t\t")])],1),s("v-spacer"),s("v-toolbar-items",{staticClass:"hidden-sm-and-down"},[t.store.user?s("v-btn",{attrs:{icon:"",to:"/_do_post",title:"記事を書く"}},[s("v-icon",[t._v("create")])],1):t._e(),s("v-btn",{attrs:{icon:"",to:"/about",title:"このサイトについて"}},[s("v-icon",[t._v("info")])],1)],1),s("UserForToolbar",{staticClass:"hidden-sm-and-down",attrs:{user:t.store.user}})],1),s("v-content",[s("v-container",[s("router-view")],1)],1)],1)},a=[],u=s("9ab4"),l=s("60a3"),c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",{attrs:{flat:""}},[t.user?s("v-list",{staticClass:"pa-0"},[s("v-list-tile",{attrs:{avatar:"",to:{name:"user",params:{userName:t.user.name}}}},[s("v-list-tile-avatar",[s("v-icon",[t._v("person")])],1),s("v-list-tile-content",[s("v-list-tile-title",[t._v(t._s(t.user.displayName))])],1)],1)],1):t._e(),s("v-list",{staticClass:"pa-0"},[t.user?s("v-list-tile",{on:{click:t.signOut}},[s("v-list-tile-action"),s("v-list-tile-content",[s("v-list-tile-title",[t._v("\n\t\t\t\t\tSignOut\n\t\t\t\t")]),t.user.registered?t._e():s("RegisterUser",{attrs:{user:t.user}})],1)],1):s("v-list-tile",{on:{click:t.signIn}},[s("v-list-tile-action"),s("v-list-tile-content",[s("v-list-tile-title",[t._v("\n\t\t\t\t\tSignIn\n\t\t\t\t")])],1)],1)],1)],1)},p=[],d=s("8aa5"),h=s.n(d),v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"registerUser"},[t._v("\n\t登録してください。\n\t"),s("div",[s("form",{on:{submit:function(e){return e.preventDefault(),t.register(e)}}},[s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],attrs:{type:"text",placeholder:"識別名"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})]),s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.displayName,expression:"displayName"}],attrs:{type:"text",placeholder:"表示名"},domProps:{value:t.displayName},on:{input:function(e){e.target.composing||(t.displayName=e.target.value)}}})]),t._m(0)])])])},f=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("input",{attrs:{type:"submit",value:"登録"}})])}];function b(t,e){return{id:t,name:e.name,displayName:e.displayName,created:e.created.toDate(),postCount:e.postCount}}function m(t,e){return null==e?{id:t.uid,displayName:t.displayName||t.email||t.uid,verified:t.emailVerified,registered:!1}:{id:t.uid,verified:t.emailVerified,registered:!0,name:e.name,displayName:e.displayName,created:e.created.toDate()}}function y(t){var e=t.data();return{subject:e.subject,body:e.body,created:e.created,updated:e.updated,id:t.id}}function g(t){return new Promise(function(e,s){h.a.firestore().collection("users").where("id","==",t.uid).get().then(function(s){if(0!==s.docs.length){var r=s.docs[0].data();console.log(r),e(m(t,r))}else e(m(t))}).catch(s)})}var _={user:null,firebaseUser:null,refresh:function(){return u["a"](this,void 0,void 0,function(){var t,e;return u["d"](this,function(s){switch(s.label){case 0:if(null==this.firebaseUser)return this.user=null,console.log("user is null"),[2];s.label=1;case 1:return s.trys.push([1,3,,4]),t=this,[4,g(this.firebaseUser)];case 2:return t.user=s.sent(),console.log("user",this.user),[3,4];case 3:return e=s.sent(),console.error("get user data error",e),[3,4];case 4:return[2]}})})},initialize:function(){var t=this,e=h.a.auth().currentUser;null!=e&&(this.firebaseUser=e,this.refresh()),h.a.auth().onAuthStateChanged(function(e){return u["a"](t,void 0,void 0,function(){return u["d"](this,function(t){return null==e?(this.firebaseUser=null,this.refresh()):(this.firebaseUser=e,this.refresh()),[2]})})},function(t){console.error("error auth: ",t)})}},P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=null,e.displayName=null,e}return u["c"](e,t),e.prototype.register=function(){if(null!=this.name&&""!==this.name&&null!=this.displayName&&""!==this.displayName){var t={id:this.user.id,name:this.name,displayName:this.displayName,created:h.a.firestore.FieldValue.serverTimestamp(),postCount:0};h.a.firestore().collection("users").doc(t.name).set(t).then(function(t){null==t?(_.refresh(),console.log("registered user")):console.error("register user error",t)}).catch(function(t){console.error("register user error",t)})}},u["b"]([Object(l["b"])()],e.prototype,"user",void 0),e=u["b"]([Object(l["a"])({})],e),e}(l["c"]),j=P,w=j,O=s("2877"),N=Object(O["a"])(w,v,f,!1,null,null,null),V=N.exports,x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u["c"](e,t),e.prototype.signIn=function(){var t=new h.a.auth.GoogleAuthProvider;h.a.auth().signInWithRedirect(t)},e.prototype.signOut=function(){h.a.auth().signOut()},u["b"]([Object(l["b"])()],e.prototype,"user",void 0),e=u["b"]([Object(l["a"])({components:{RegisterUser:V}})],e),e}(l["c"]),T=x,$=T,I=s("6544"),k=s.n(I),C=s("b0af"),U=s("132d"),L=s("8860"),F=s("ba95"),E=s("40fe"),R=s("c954"),M=s("5d23"),D=Object(O["a"])($,c,p,!1,null,null,null),S=D.exports;k()(D,{VCard:C["a"],VIcon:U["a"],VList:L["a"],VListTile:F["a"],VListTileAction:E["a"],VListTileAvatar:R["a"],VListTileContent:M["a"],VListTileTitle:M["c"]});var A=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-toolbar-items",[t.user?s("v-btn",{attrs:{flat:"",to:{name:"user",params:{userName:t.user.name}}}},[t._v("\n\t\t\t"+t._s(t.user.displayName)+"\n\t\t")]):t._e(),t.user?s("v-btn",{attrs:{flat:""},on:{click:t.signOut}},[t._v("signOut")]):s("v-btn",{attrs:{flat:""},on:{click:t.signIn}},[t._v("signIn")])],1)},B=[],z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u["c"](e,t),e.prototype.signIn=function(){var t=new h.a.auth.GoogleAuthProvider;h.a.auth().signInWithRedirect(t)},e.prototype.signOut=function(){h.a.auth().signOut()},u["b"]([Object(l["b"])()],e.prototype,"user",void 0),e=u["b"]([Object(l["a"])({components:{RegisterUser:V}})],e),e}(l["c"]),q=z,G=q,H=s("8336"),J=s("2a7f"),W=Object(O["a"])(G,A,B,!1,null,null,null),Y=W.exports;k()(W,{VBtn:H["a"],VToolbarItems:J["a"]});var K=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.store=_,e.drawer=!1,e}return u["c"](e,t),e=u["b"]([Object(l["a"])({components:{UserForList:S,UserForToolbar:Y}})],e),e}(l["c"]),Q=K,X=Q,Z=(s("cda6"),s("7496")),tt=s("a523"),et=s("549c"),st=s("ce7e"),rt=s("f774"),nt=s("9910"),ot=s("71d9"),it=s("706c"),at=Object(O["a"])(X,i,a,!1,null,"56c396fa",null),ut=at.exports;k()(at,{VApp:Z["a"],VBtn:H["a"],VContainer:tt["a"],VContent:et["a"],VDivider:st["a"],VIcon:U["a"],VList:L["a"],VListTile:F["a"],VListTileAction:E["a"],VListTileContent:M["a"],VListTileTitle:M["c"],VNavigationDrawer:rt["a"],VSpacer:nt["a"],VToolbar:ot["a"],VToolbarItems:J["a"],VToolbarSideIcon:it["a"],VToolbarTitle:J["b"]});var lt=s("8c4f"),ct=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"home"}},[s("v-list",{attrs:{"two-line":""}},[t._l(t.posts,function(t,e){return[s("TopPostTitle",{key:e,attrs:{post:t}})]})],2)],1)},pt=[],dt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-list-tile",{attrs:{to:{name:"userPost",params:{userName:t.post.userName,postId:t.post.postRef.id}}}},[s("v-list-tile-content",[s("v-list-tile-title",[t._v(t._s(t.post.subject))]),s("v-list-tile-sub-title",[t._v("\n\t\t\t"+t._s(t.date)+"\n\t\t\t -\n\t\t\t"),s("router-link",{attrs:{to:{name:"user",params:{userName:t.post.userName}}}},[t._v("\n\t\t\t\t"+t._s(t.post.userDisplayName)+"\n\t\t\t")])],1)],1)],1)},ht=[],vt=s("d4cd"),ft=s.n(vt),bt=ft()({html:!0,linkify:!0});function mt(t){return bt.render(t)}function yt(t){var e=t.toDate();return e.getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日 "+e.getHours()+"時"+e.getMinutes()+"分"}var gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u["c"](e,t),Object.defineProperty(e.prototype,"date",{get:function(){return yt(this.post.created)},enumerable:!0,configurable:!0}),u["b"]([Object(l["b"])()],e.prototype,"post",void 0),e=u["b"]([Object(l["a"])({})],e),e}(l["c"]),_t=gt,Pt=_t,jt=Object(O["a"])(Pt,dt,ht,!1,null,null,null),wt=jt.exports;k()(jt,{VListTile:F["a"],VListTileContent:M["a"],VListTileSubTitle:M["b"],VListTileTitle:M["c"]});var Ot=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.postRef=null,e.posts=[],e}return u["c"](e,t),e.prototype.created=function(){return u["a"](this,void 0,void 0,function(){var t,e,s=this;return u["d"](this,function(r){switch(r.label){case 0:console.log("home created"),this.postRef=h.a.firestore().collection("allPosts"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.postRef.orderBy("created","desc").limit(100).get()];case 2:return t=r.sent(),this.posts=[],t.forEach(function(t){var e=t.data();s.posts.push({subject:e.subject,body:e.body,created:e.created,updated:e.updated,postRef:e.postRef,userId:e.userId,userName:e.userName,userDisplayName:e.userDisplayName})}),[3,4];case 3:return e=r.sent(),console.error("get data error",e),[3,4];case 4:return[2]}})})},e=u["b"]([Object(l["a"])({components:{TopPostTitle:wt}})],e),e}(l["c"]),Nt=Ot,Vt=Nt,xt=Object(O["a"])(Vt,ct,pt,!1,null,null,null),Tt=xt.exports;k()(xt,{VList:L["a"]});var $t=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-form",{ref:"postForm",attrs:{id:"postForm","lazy-validation":""},on:{submit:function(e){return e.preventDefault(),t.post(e)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.msg,expression:"msg"}]},[t._v(t._s(t.msg))]),s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs12:"",md12:""}},[s("v-text-field",{attrs:{placeholder:"タイトル","aria-label":"ブログの記事タイトル",required:"",label:"タイトル",rules:t.titleRule},model:{value:t.subject,callback:function(e){t.subject=e},expression:"subject"}})],1),s("v-flex",{attrs:{xs12:"",sm12:"",md6:""}},[s("v-textarea",{attrs:{placeholder:"本文","aria-label":"ブログの本文",required:"","auto-grow":"",label:"本文",rules:t.bodyRule,rows:"16"},model:{value:t.body,callback:function(e){t.body=e},expression:"body"}})],1),s("v-flex",{attrs:{xs12:"",sm12:"",md6:""}},[s("MarkdownView",{attrs:{body:t.body}})],1)],1),s("v-btn",{attrs:{color:"success"},on:{click:t.post}},[t._v("投稿")])],1)},It=[],kt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{domProps:{innerHTML:t._s(t.preview)}})},Ct=[],Ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u["c"](e,t),Object.defineProperty(e.prototype,"preview",{get:function(){return mt(this.body)},enumerable:!0,configurable:!0}),u["b"]([Object(l["b"])()],e.prototype,"body",void 0),e=u["b"]([Object(l["a"])({})],e),e}(l["c"]),Lt=Ut,Ft=Lt,Et=Object(O["a"])(Ft,kt,Ct,!1,null,null,null),Rt=Et.exports,Mt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.subject="",e.body="",e.msg="",e}return u["c"](e,t),Object.defineProperty(e.prototype,"titleRule",{get:function(){return[function(t){return 0!==t.length||"タイトルを入力してください"}]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bodyRule",{get:function(){return[function(t){return 0!==t.length||"本文を入力してください"}]},enumerable:!0,configurable:!0}),e.prototype.post=function(){return u["a"](this,void 0,void 0,function(){var t,e;return u["d"](this,function(s){switch(s.label){case 0:if(console.log("posted"),console.log("validate?",this.$refs.postForm.validate()),!this.$refs.postForm.validate())return[2];if(null==this.owner||!this.owner.registered)return this.msg="ログインしてください。",[2];t={subject:this.subject,body:this.body,created:h.a.firestore.FieldValue.serverTimestamp(),updated:h.a.firestore.FieldValue.serverTimestamp()},console.log(t),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,h.a.firestore().collection("users").doc(this.owner.name).collection("posts").add(t)];case 2:return s.sent(),this.$_postForm_clear(),this.msg="投稿しました。",[3,4];case 3:return e=s.sent(),console.error("add error",e),this.msg="投稿失敗",[3,4];case 4:return[2]}})})},e.prototype.$_postForm_clear=function(){this.subject="",this.body="",this.$refs.postForm.resetValidation()},u["b"]([Object(l["b"])()],e.prototype,"owner",void 0),e=u["b"]([Object(l["a"])({components:{MarkdownView:Rt}})],e),e}(l["c"]),Dt=Mt,St=Dt,At=s("0e8f"),Bt=s("4bd4"),zt=s("a722"),qt=s("2677"),Gt=s("a844"),Ht=Object(O["a"])(St,$t,It,!1,null,null,null),Jt=Ht.exports;k()(Ht,{VBtn:H["a"],VFlex:At["a"],VForm:Bt["a"],VLayout:zt["a"],VTextField:qt["a"],VTextarea:Gt["a"]});var Wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"user"}},[t.user?s("h1",[t._v(t._s(t.user.displayName)+"の投稿")]):t._e(),[s("div",{staticClass:"prev_pager"},[t.hasPrev?[s("v-btn",{attrs:{color:"info"},on:{click:t.prev}},[t._v("新しい記事")])]:t._e()],2),t._l(t.posts,function(e,r){return s("PostView",{key:r,staticClass:"mb-4",attrs:{post:e,user:t.user}})}),s("div",{staticClass:"next_pager"},[t.hasNext?[s("v-btn",{attrs:{color:"info"},on:{click:t.next}},[t._v("前の記事")])]:t._e()],2)]],2)},Yt=[],Kt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",[s("v-card-title",[s("h1",[s("router-link",{attrs:{to:{name:"userPost",params:{userName:t.user.name,postId:t.post.id}}}},[t._v("\n\t\t\t\t"+t._s(t.post.subject)+"\n\t\t\t")])],1)]),s("v-divider"),s("v-card-text",[s("MarkdownView",{attrs:{body:t.post.body}})],1),s("v-divider"),s("v-card-text",[s("router-link",{attrs:{to:{name:"user",params:{userName:t.user.name}}}},[t._v("\n\t\t\t"+t._s(t.user.displayName)+"\n\t\t")]),s("span",[t._v(" - "+t._s(t.date))])],1)],1)},Qt=[],Xt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u["c"](e,t),Object.defineProperty(e.prototype,"date",{get:function(){return yt(this.post.created)},enumerable:!0,configurable:!0}),u["b"]([Object(l["b"])()],e.prototype,"user",void 0),u["b"]([Object(l["b"])()],e.prototype,"post",void 0),e=u["b"]([Object(l["a"])({components:{MarkdownView:Rt}})],e),e}(l["c"]),Zt=Xt,te=Zt,ee=s("99d9"),se=s("12b2"),re=Object(O["a"])(te,Kt,Qt,!1,null,null,null),ne=re.exports;k()(re,{VCard:C["a"],VCardText:ee["a"],VCardTitle:se["a"],VDivider:st["a"]});var oe=h.a.firestore,ie=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.posts=[],e.lastPost=null,e.firstPost=null,e.hasPrev=!1,e.hasNext=!1,e.user=null,e.sinceId=null,e}return u["c"](e,t),Object.defineProperty(e.prototype,"prevLink",{get:function(){return null==this.firstPost?"?":"?since="+this.firstPost.id+"&order=asc"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextLink",{get:function(){return null==this.lastPost?"?":"?since="+this.lastPost.id},enumerable:!0,configurable:!0}),e.prototype.next=function(){return u["a"](this,void 0,void 0,function(){var t,e;return u["d"](this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.$_UserPosts_getPosts(this.lastPost)];case 1:return t=s.sent(),this.posts=this.posts.concat(t),this.$_UserPosts_refreshLastFirst(t),[3,3];case 2:return e=s.sent(),[2,Promise.reject(e)];case 3:return[2]}})})},e.prototype.prev=function(){return u["a"](this,void 0,void 0,function(){var t,e,s=this;return u["d"](this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.$_UserPosts_getPosts(this.firstPost,"asc")];case 1:return t=r.sent(),t.forEach(function(t){s.posts.unshift(t)}),this.$_UserPosts_refreshLastFirst(t,"asc"),[3,3];case 2:return e=r.sent(),[2,Promise.reject(e)];case 3:return[2]}})})},e.prototype.created=function(){return u["a"](this,void 0,void 0,function(){var t,e,s,r;return u["d"](this,function(n){switch(n.label){case 0:console.log("user created",this.userName,this.since,this.order),t=oe().collection("users").doc(this.userName),n.label=1;case 1:return n.trys.push([1,4,,5]),this.sinceId=this.since,[4,t.get()];case 2:return e=n.sent(),s=this,[4,this.$_UserPosts_getPostsByProps()];case 3:return s.posts=n.sent(),"asc"===this.order&&this.posts.reverse(),this.user=b(this.userName,e.data()),this.$_UserPosts_refreshLastFirst(this.posts,this.order),[3,5];case 4:return r=n.sent(),console.error("get data error",r),[3,5];case 5:return[2]}})})},e.prototype.$_UserPosts_getPosts=function(t,e){return void 0===t&&(t=null),void 0===e&&(e="desc"),u["a"](this,void 0,void 0,function(){var s,r,n,o,i;return u["d"](this,function(a){switch(a.label){case 0:a.trys.push([0,5,,6]),s=oe().collection("users").doc(this.userName).collection("posts"),r=s.limit(this.pagingCount).orderBy("created",e),null!=t&&(r=r.startAfter(t.created)),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,r.get()];case 2:return n=a.sent(),[2,this.$_UserPosts_createPosts(n,e)];case 3:return o=a.sent(),[2,Promise.reject(o)];case 4:return[3,6];case 5:return i=a.sent(),[2,Promise.reject(i)];case 6:return[2]}})})},e.prototype.$_UserPosts_createPosts=function(t,e){void 0===e&&(e="desc");var s=[];return t.forEach(function(t){s.push(y(t))}),s},e.prototype.$_UserPosts_getPostsByProps=function(){return u["a"](this,void 0,void 0,function(){var t;return u["d"](this,function(e){switch(e.label){case 0:return null==this.since?[3,3]:[4,this.$_UserPosts_getPost(this.since)];case 1:return t=e.sent(),[4,this.$_UserPosts_getPosts(t,this.order)];case 2:return[2,e.sent()];case 3:return[2,this.$_UserPosts_getPosts()]}})})},e.prototype.$_UserPosts_refreshLastFirst=function(t,e){void 0===e&&(e="desc"),this.posts.length>0?(this.posts.length>this.showCount&&("desc"===e?(this.posts=this.posts.slice(this.posts.length-this.showCount),this.sinceId=this.posts[0].id):(this.posts=this.posts.slice(0,this.showCount-this.posts.length),this.sinceId=this.posts[this.posts.length-1].id)),this.lastPost=this.posts[this.posts.length-1],this.firstPost=this.posts[0]):(this.lastPost=null,this.firstPost=null),"desc"===e?(this.hasNext=t.length>=this.pagingCount,this.hasPrev=null!=this.sinceId):(this.hasPrev=t.length>=this.pagingCount,this.hasNext=null!=this.sinceId)},e.prototype.$_UserPosts_getPost=function(t){return u["a"](this,void 0,Promise,function(){var e,s,r;return u["d"](this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=oe().collection("users").doc(this.userName).collection("posts").doc(t),[4,e.get()];case 1:return s=n.sent(),s.exists?[2,y(s)]:[2,null];case 2:return r=n.sent(),[2,Promise.reject(r)];case 3:return[2]}})})},u["b"]([Object(l["b"])()],e.prototype,"userName",void 0),u["b"]([Object(l["b"])({required:!1,default:null})],e.prototype,"since",void 0),u["b"]([Object(l["b"])({required:!0,default:"desc"})],e.prototype,"order",void 0),u["b"]([Object(l["b"])({type:Number,default:5})],e.prototype,"pagingCount",void 0),u["b"]([Object(l["b"])({type:Number,default:10})],e.prototype,"showCount",void 0),e=u["b"]([Object(l["a"])({components:{PostView:ne}})],e),e}(l["c"]),ae=ie,ue=ae,le=Object(O["a"])(ue,Wt,Yt,!1,null,null,null),ce=le.exports;k()(le,{VBtn:H["a"]});var pe=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"home"}},[t.post?s("PostView",{attrs:{user:t.user,post:t.post}}):t._e(),s("RelativePost",{attrs:{post:t.post,userName:t.userName}})],1)},de=[],he=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.relativePosts.length>0?s("h3",[t._v("他の記事")]):t._e(),s("ul",t._l(t.relativePosts,function(e,r){return s("li",{key:r},[s("PostLink",{attrs:{userName:t.userName,post:e}})],1)}),0)])},ve=[],fe=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",[s("router-link",{attrs:{to:{name:"userPost",params:{userName:t.userName,postId:t.post.id}}}},[t._v("\n\t\t"+t._s(t.post.subject)+"\n\t")]),t._v("\n\t ("+t._s(t.date)+")\n")],1)},be=[],me=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u["c"](e,t),Object.defineProperty(e.prototype,"date",{get:function(){return yt(this.post.created)},enumerable:!0,configurable:!0}),u["b"]([Object(l["b"])()],e.prototype,"userName",void 0),u["b"]([Object(l["b"])()],e.prototype,"post",void 0),e=u["b"]([Object(l["a"])({})],e),e}(l["c"]),ye=me,ge=ye,_e=Object(O["a"])(ge,fe,be,!1,null,null,null),Pe=_e.exports,je=h.a.firestore,we=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.relativePosts=[],e}return u["c"](e,t),e.prototype.$_RelativePost_onPostChanged=function(){return u["a"](this,void 0,void 0,function(){var t,e,s,r,n=this;return u["d"](this,function(o){switch(o.label){case 0:this.relativePosts=[],t=je().collection("users").doc(this.userName).collection("posts"),o.label=1;case 1:return o.trys.push([1,3,,4]),e=je.Timestamp.fromMillis(this.post.created.toMillis()-2592e6),[4,t.where("created",">",e).limit(10).get()];case 2:s=o.sent(),s.forEach(function(t){t.id!==n.post.id&&n.relativePosts.push(y(t))});while(this.relativePosts.length>3)this.relativePosts.splice(Math.floor(Math.random()*this.relativePosts.length),1);return[3,4];case 3:return r=o.sent(),console.error("get relative post error",r),[3,4];case 4:return[2]}})})},u["b"]([Object(l["b"])()],e.prototype,"userName",void 0),u["b"]([Object(l["b"])()],e.prototype,"post",void 0),u["b"]([Object(l["d"])("post")],e.prototype,"$_RelativePost_onPostChanged",null),e=u["b"]([Object(l["a"])({components:{PostLink:Pe}})],e),e}(l["c"]),Oe=we,Ne=Oe,Ve=Object(O["a"])(Ne,he,ve,!1,null,null,null),xe=Ve.exports,Te=h.a.firestore,$e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.post=null,e.relativePosts=[],e.user=null,e}return u["c"](e,t),e.prototype.created=function(){return u["a"](this,void 0,void 0,function(){var t,e;return u["d"](this,function(s){switch(s.label){case 0:return console.log("user post created",this.userName,this.postId),t=Te().collection("users").doc(this.userName),[4,t.get()];case 1:return e=s.sent(),this.user=b(this.userName,e.data()),[2,this.$_UserPost_onPostIdChanged()]}})})},e.prototype.$_UserPost_onPostIdChanged=function(){return u["a"](this,void 0,void 0,function(){var t,e,s,r,n,o,i=this;return u["d"](this,function(a){switch(a.label){case 0:t=Te().collection("users").doc(this.userName),this.relativePosts=[],a.label=1;case 1:return a.trys.push([1,4,,5]),e=t.collection("posts"),[4,e.doc(this.postId).get()];case 2:return s=a.sent(),this.post=y(s),r=Te.Timestamp.fromMillis(this.post.created.toMillis()-2592e6),[4,e.where("created",">",r).limit(10).get()];case 3:n=a.sent(),n.forEach(function(t){t.id!==i.postId&&i.relativePosts.push(y(t))});while(this.relativePosts.length>3)this.relativePosts.splice(Math.floor(Math.random()*this.relativePosts.length),1);return[3,5];case 4:return o=a.sent(),console.error("get data error",o),[3,5];case 5:return[2]}})})},u["b"]([Object(l["b"])()],e.prototype,"userName",void 0),u["b"]([Object(l["b"])()],e.prototype,"postId",void 0),u["b"]([Object(l["d"])("postId")],e.prototype,"$_UserPost_onPostIdChanged",null),e=u["b"]([Object(l["a"])({components:{PostView:ne,RelativePost:xe}})],e),e}(l["c"]),Ie=$e,ke=Ie,Ce=Object(O["a"])(ke,pe,de,!1,null,null,null),Ue=Ce.exports;function Le(t,e){return void 0===e&&(e=null),null==t?e:"string"===typeof t?parseInt(t,10):parseInt(t[0],10)}function Fe(t){return"asc"===t?"asc":"desc"}r["default"].use(lt["a"]);var Ee=new lt["a"]({mode:"history",base:"/",routes:[{path:"/",name:"home",component:Tt},{path:"/about",name:"about",component:function(){return s.e("about").then(s.bind(null,"f3be"))}},{path:"/_do_post",name:"post",component:Jt,props:function(t){return{owner:_.user}}},{path:"/:userName",name:"user",component:ce,props:function(t){return{userName:t.params.userName,since:t.query.since,order:Fe(t.query.order),page:Le(t.query.page,0)}}},{path:"/:userName/:postId",name:"userPost",component:Ue,props:!0}]});r["default"].config.productionTip=!1;var Re={apiKey:"AIzaSyBjpgvDitkbscY8sGri0mHxoiInhhFrLt8",authDomain:"shinonomekazan-blog.firebaseapp.com",databaseURL:"https://shinonomekazan-blog.firebaseio.com",projectId:"shinonomekazan-blog",storageBucket:"shinonomekazan-blog.appspot.com",messagingSenderId:"1017881661292"};h.a.initializeApp(Re),_.initialize(),new r["default"]({router:Ee,render:function(t){return t(ut)}}).$mount("#app")},cda6:function(t,e,s){"use strict";var r=s("3707"),n=s.n(r);n.a}});
//# sourceMappingURL=app.b3d0fa03.js.map